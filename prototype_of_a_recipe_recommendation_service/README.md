# DAY 15 – Введение в анализ данных
## Прототип рекомендательного сервиса рецептов 
Проект поможет вам закрепить навыки, полученные в ходе выполнения предыдущих задач.

## Оглавление

1. [Глава I](#глава-i) \
    1.1. [Преамбула](#преамбула)
2. [Глава II](#глава-ii) \
    2.1. [Общая инструкция](#общая-инструкция)
3. [Глава III](#глава-iii) \
    3.1. [Цели](#цели)
4. [Глава IV](#глава-iv) \
    4.1. [Обязательная часть](#обязательная-часть)
5. [Глава V](#глава-v) \
    5.1. [Сдача работы и проверка](#сдача-работы-и-проверка)

## Глава I
### Преамбула

Вы — это то, что вы едите. Организм можно представить как систему, которой требуется множество различных питательных веществ, для того чтобы  жить счастливо и продуктивно. Если организму станет не хватать каких-либо питательных веществ, то важные химические процессы в нем приостановятся, и ваше здоровье в конечном счете ухудшится.

Чтобы сохранить здоровье, нужно сбалансированно питаться. Организму нужны белки, углеводы и жиры, а также микроэлементы Fe, Mg, Na, K, Ca, Zn, Se, Cr, I; витамины D, B12, E, C, A, K, Cu и пр. Это достаточно длинный, но далеко не полный список всего того, что требуется для поддержания здоровья. Если вы потребляете недостаточно белка, ваш организм начнет извлекать его из мышц, органов и тканей. В итоге возникнет нехватка определенных ферментов, гормонов, белков, иммунных клеток и пр., которые производились в этих органах. Если вы потребляете слишком много белка, то организм не будет успевать его усваивать, начнется интоксикация, и в таком случае ваше здоровье  опять-таки ухудшится. И это относится к избыточному потреблению любых элементов из списка, приведенного выше. «Лекарство — яд, но яд — лекарство. Одна лишь доза превратит лекарство в яд, и яд в лекарство…»

Первая проблема заключается в том, что наше питание не так разнообразно, как должно было быть, если мы говорим о среднестатистическом человеке. Как часто вы едите овощи, фрукты, орехи, бобы, ягоды, хлеб, выпечку, рыбу, мясо, морскую капусту и сливочное масло? Как часто вы пьете кофе, зеленый чай, молоко, алкогольные напитки, соки и смузи?

Вторая проблема состоит в том, что мы любим вкусную, но не полезную еду: картофель фри, чипсы и тому подобное. Третья проблема заключается в том, что мы не знаем достаточное количество рецептов вкусных блюд, полезных для здоровья.

Что, если бы у нас было приложение, которое могло бы информировать нас о том, насколько вкусным может быть блюдо, приготовленное из продуктов, которые есть у нас сейчас в холодильнике, и какие питательные вещества оно будет содержать, а также могло бы рекомендовать нам рецепты блюд, одновременно полезных и вкусных?



## Глава II
### Общая инструкция

Методология Школы 21 может быть не похожа на тот образовательный опыт, который с вами случался ранее. Её отличает высокий уровень автономии: у вас есть задача, вы должны её выполнить. По большей части вам нужно будет самим добывать знания для её решения. Второй важный момент — это peer-to-peer обучение. В образовательном процессе нет преподавателей и экспертов, перед которыми вы защищаете свой результат. Вы это делаете перед таким же учащимися, как и вы сами. У них есть чек-лист, который поможет им качественно выполнить приемку вашей работы.

Роль Школы 21 заключается в том, чтобы обеспечить через последовательность заданий и оптимальный уровень поддержки такую траекторию обучения, при которой вы не только освоите hard skills, но и научитесь самообучаться.

* Не доверяйте слухам и предположениям о том, как должно быть оформлено ваше решение. Этот документ является единственным источником, к которому стоит обращаться по большинству вопросов;
* ваше решение будет оцениваться другими учащимися;
* подлежат оцениванию только те файлы, которые вы выложили в GIT (ветка develop, папка src);
* в вашей папке не должно быть лишних файлов — только те, что были указаны в задании;
* не забывайте, что у вас есть доступ к интернету и поисковым системам;
* обсуждение заданий можно вести и в Slack;
* будьте внимательны к примерам, указанным в этом документе — они могут иметь важные детали, которые не были оговорены другим способом;
* и да пребудет с вами Сила!


## Глава III
### Цели

В этом проекте, с одной стороны, вы сможете закрепить все навыки, которые были приобретены ранее, а с другой – решить не просто задачу машинного обучения или анализа данных, а сделать продукт на их основе. Точнее – его прототип.


## Глава IV
### Обязательная часть
В рамках этого проекта вы будете разрабатывать собственное приложение, которое поможет людям потреблять более здоровую и вкусную пищу. Разработка прототипа готового продукта на основе изученных вами технологий станет для вас хорошим и полезным опытом. 

Вся работа будет разделена на три этапа: исследование (с помощью Jupyter Notebook), разработка (организация всех элементов в рамках одного модуля, содержащего классы и методы) и работа с самой программой (запуск скрипта Python). На каждом из этих этапов должны быть созданы соответствующие файлы как результат завершенного этапа: `.ipynb`, `.py` модуль с классами и методами, `.py` с основной программой.

#### 1. Основная программа
Давайте начнем с конца. Эта программа представляет собой скрипт на языке Python (`nutritionist.py`).
1. Она принимает на вход список ингредиентов.
2. Она создает прогноз и выдает рейтинг с оценкой (`невкусное`, `нормальное`, `вкусное`) блюда, которое можно приготовить на основе списка переданных ингредиентов.
3. Она находит и выводит информацию обо всех питательных веществах (белках, жирах, натрии и т. д.) продуктов из списка, а также их объем в процентах от суточной нормы потребления.
4. Она отображает три рецепта блюд, в которых используется максимальное количество продуктов из списка, с указанием их оценки и ссылок, по которым пользователь сможет найти полную информацию.

Пример работы программы:
```bash
$ ./nutritionist.py milk, honey, jam
I. НАШ ПРОГНОЗ

Невкусное. Хоть конкретно вам может быть и понравится блюдо из этих ингредиентов, но, на наш взгляд, это плохая идея – готовить блюдо из них. Хотели предупредить.

II. ПИЩЕВАЯ ЦЕННОСТЬ
Milk
Protein – 6% of Daily Value
Total Carbohydrate – 1% of Daily Value
Total Fat – 1% of Daily Value
Calcium – 12% of Daily Value
…

Honey
…

Jam
…

III. ТОП-3 ПОХОЖИХ РЕЦЕПТА:
- Strawberry-Soy Milk Shake, рейтинг: 3.0, URL: https://www.epicurious.com/recipes/food/views/strawberry-soy-milk-shake-239217
- …
- …

```
#### 2. Разработка
Вы должны создать модуль Python (`recipes.py`) с классами и методами, которые используются в основной программе.

1. Класс `Forecast`

```python
class Forecast:
    """
    Предсказание рейтинга блюда или его класса
    """
    def __init__(self, list_of_ingredients):
        """
        Добавьте сюда любые поля и строчки кода, которые вам покажутся нужными.
        """
  
    def preprocess(self):
        """
        Этот метод преобразует список ингредиентов в структуры данных, 
        которые используются в алгоритмах машинного обучения, чтобы сделать предсказание.
        """
       return vector
        
    def predict_rating(self):
        """
        Этот метод возвращает рейтинг для списка ингредиентов, используя регрессионную модель, 
        которая была обучена заранее. Помимо самого рейтинга, метод также возвращает текст, 
        который дает интерпретацию этого рейтинга и дает рекомендацию, как в примере выше.
        """
        return rating, text
        
    def predict_rating_category(self):
        """
        Этот метод возращает рейтинговую категорию для списка ингредиентов, используя классификационную модель, 
        которая была обучена заранее. Помимо самого рейтинга, метод возвращает также и текст, 
        который дает интерпретацию этой категории и дает рекомендации, как в примере выше.
        """
        return rating_cat, text
```

2. Класс `NutritionFacts`

```python
class NutritionFacts:
    """
    Выдает информацию о пищевой ценности ингредиентов.
    """
    def __init__(self, list_of_ingredients):
        """
        Добавьте сюда любые поля и строчки кода, которые вам покажутся нужными.
        """

    def retrieve(self):
        """
        Этот метод получает всю имеющуюся информацию о пищевой ценности из файла с заранее собранной информацией по заданным ингредиентам. 
        Он возвращает ее в том виде, который вам кажется наиболее удобным и подходящим.
        """
        return facts

    def filter(self, must_nutrients, n):
        """
        Этот метод отбирает из всей информации о пищевой ценности только те нутриенты, которые были заданы в must_nutrients (пример в PDF-файле ниже), 
        а также топ-n нутриентов с наибольшим значением дневной нормы потребления для заданного ингредиента. 
        Он возвращает текст, отформатированный как в примере выше.
        """
        return text_with_facts
```

3. Класс `SimilarRecipes`

```python
class SimilarRecipes:
    """
    Рекомендация похожих рецептов с дополнительной информацией
    """
    def __init__(self, list_of_ingredients):
        """
        Добавьте сюда любые поля и строчки кода, которые вам покажутся нужными.
        """    

    def find_all(self):
        """
        Этот метод возвращает список индексов рецептов, которые содержат заданный список ингредиентов. 
        Если нет ни одного рецепта, содержащего все эти ингредиенты, то сделайте обработку ошибки, чтобы программа не ломалась.
        """
        return indexes
    
    def top_similar(self, n):
        """
        Этот метод возвращает текст, форматированный как в примере выше: с заголовком, рейтингом и URL. 
        Чтобы это сделать, он вначале находит топ-n наиболее похожих рецептов с точки зрения количества дополнительных ингредиентов, 
        которые потребуются в этих рецептах. Наиболее похожим будет тот, в котором не требуется никаких других ингредиентов. 
        Далее идет тот, у которого появляется 1 доп. ингредиент. Далее – 2. 
        Если рецепт нуждается в более, чем 5 доп. ингредиентах, то такой рецепт не выводится.
        """
        return text_with_recipes
```

#### 3. Исследование
В этой части проекта вы должны подготовить все, что используется в классах и методах, описанных выше, в Jupyter Notebook (`recipes.ipynb`). 

##### 3.1. Прогноз
1. Подготовка данных
    - Используйте [датасет из Epicurious](datasets/epi_r.csv.zip), подготовленный HugoDarwood
    - Отфильтруйте поля: удалите как можно больше столбцов, которые не относятся к названиями ингридиентов. Вы будете прогнозировать оценку или категорию оценки, используя только ингридиенты и ничего больше. Если модель обучится на других данных, которые не будут передаваться на вход, то точность прогнозов будет заведомо ниже.

2. Регрессия
    - Для прогнозирования рейтинга опробуйте различные алгоритмы и их гиперпараметры. Выберите лучшее решение на основе gridsearch и кроссвалидации и оцените RMSE на тестовой подвыборке.
    - Попробуйте различные ансамбли и их гиперпараметры. Выберите лучшее решение на основе gridsearch и кроссвалидации и оцените RMSE на тестовой подвыборке.
    - Посчитайте RMSE для наивного регрессора, в котором вы просто высчитали средний рейтинг.

3. Классификация
    - Бинаризируйте значения целевой переменной путем округления рейтингов до ближайшего целого числа. Это и будут ваши классы.
    - Для прогнозирования классов попробуйте различные алгоритмы и их гиперпараметры. Выберите лучшее решение на основе gridsearch и кроссвалидации и посчитайте accuracy на тестовой подвыборке.
    - Рассчитайте значение accuracy наивного классификатора, в котором вы для всех наблюдений прогнозируете наиболее распространенный класс. Сравните метрики.
    - Снова проведите бинаризацию целевого столбца, преобразовав теперь целые числа в классы `bad` (0, 1) (невкусное), `so-so` (2, 3) (нормальное), `great` (4, 5) (вкусное).
    - Снова для прогнозирования классов попробуйте различные алгоритмы и их гиперпараметры. Выберите лучшее решение на основе кроссвалидации и посчитайте accuracy на тестовой подвыборке.
    - Снова рассчитайте значение accuracy наивного классификатора, в котором вы для всех наблюдений прогнозируете наиболее распространенный класс. Сравните метрики.
    - Что хуже: спрогнозировать плохой рейтинг, который на самом деле окажется хорошим, или спрогнозировать хороший рейтинг, который на самом деле окажется плохим? Замените метрику accuracy другой соответствующей метрикой.
    - Для прогнозирования классов с новой метрикой опробуйте различные алгоритмы и их гиперпараметры. Выберите лучшее решение и посчитайте метрику на тестовой подвыборке.
    - Попробуйте различные ансамбли и их гиперпараметры. Выберите лучшее решение и посчитайте метрику на тестовой подвыборке.

4. Принятие решения
    - Примите решение о том, что лучше использовать: регрессионную модель или классификацию. Сохраните выбранную модель. Вы будете использовать ее в основной программе.

##### 3.2. Пищевая ценность
1. Соберите в датафрейм всю информацию о пищевой ценности продуктов из подготовленного вами и отфильтрованного набора данных (только столбцы с продуктами). Используйте для этого [следующий API](https://fdc.nal.usda.gov/api-guide.html).
2. Конвертируйте все значения в % от суточной нормы потребления. Сохраняйте только те ингридиенты, которые находятся в [этой](datasets/Daily-Reference-Values-_DRVs_-under-the-New-NFL.pdf) и [этой](datasets/Reference-Daily-Intakes-_RDIs_-in-the-New-Nutrition-Facts-Label.pdf) таблицах.
3. Сохраните измененный датафрейм в CSV-файл, который вы будете использовать в своей основной программе.


##### 3.3. Похожие рецепты
1. Для каждого рецепта из набора данных найдите ссылку на сайте [epicurious.com](epicurious.com) и подробную информацию о нем (название рецепта, рейтинг на платформе и URl). Если сделать это не удалось, найдите для данного рецепта похожую ссылку в Интернете.
2. Сохраните новый датафрейм в CSV-файл, который вы будете использовать в своей основной программе.

### Бонусная часть
Добавьте в классы дополнительные методы, которые помогут скрипту выполнить новую функцию: составление меню на день.

В ежедневном меню случайным образом должен выводиться список из трех рецептов, которые покрывают большую часть потребностей в питании (% от суточной пищевой ценности) и имеют самую высокую общую оценку.
Вы должны предлагать только рецепты, которые подходят для завтрака, обеда и ужина, соответственно.
Результат работы программы должен выглядеть следующим образом:

```bash
    ЗАВТРАК
	---------------------
	Feta, Spinach, and Basil Omelette Muffins (рейтинг: 4.375)
		
Ингредиенты:
	- arugula
	- egg
	- feta
	- muffin
	- omelet
	- spinach
	- tomato

	Nutrients:
	- calories: 7.5%
	- protein: 16%
	- fat: 10%
	- sodium: 7 % 
	- …
		
	URL: https://www.epicurious.com/recipes/food/views/feta-spinach-and-basil-omelette-muffins

	ОБЕД
	---------------------
	… 


```


## Глава V
### Сдача работы и проверка

1. В основной программе используйте классы и методы, которые вы написали на этапе разработки.
2. Наличие любого не обработанного исключения (ошибки) будет означать, что вы не справились с заданием. Любая ошибка должна либо давать какую-то информацию пользователю, либо выдавать какое-то альтернативное решение.
3. Загрузите все файлы с кодом (`recipes.ipynb`, `recipes.py`, `nutritionist.py`) в GIT-репозиторий этого проекта для проверки, а также все иные файлы, необходимые для того, чтобы этот код выполнялся (например, CSV-файлы, в которых хранится предобработанная и собранная информация).

Пожалуйста, оставьте обратную связь по проекту в [форме обратной связи.](https://forms.gle/UKsYgG57GTN9gny88)
